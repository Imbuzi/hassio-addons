language: python

python:
  - 2.7

env:
  global:
    - VERSION: 0.1.2
    - secure: 4xC5AAfwaMCA/y1ZgcYgjAUqiB0PjLqBU7fWkLLIXPRHJgRvlH3aqp6qLwHxtQKw8RThIsfHb67tpHWc0JvoGpOWflGr2Tx+5581mU/tkXFjExiN4W0GrQofrodBvmaH0V9Ee6EtnmX17rmHRA4BcDMrRLjQXwhlZZLCSmcmbKrXmn+JHQEuQR6ma+aXab5R3rLvDGEpoHAoF+rUAsGmkesDIH2iXzL+fTjJRJbr9oFsX39Ih0OYmiGI+G2B0Pr7/Vy2xO+AK8BEkxyRtpZltPUSuOpBkK2YrnLZFGUsGH4gTVDIFj5dXxMnFyaeDFHNb0jB7sDuEOyHRul0LpQZKw==
    - secure: wnmYnlMFl2mYvnXfQ9eO0YNhe2cmlF70MtiABwZOWmixbr5GzXyCmMp1BgUwsXntBzTojAShi1NO9JLPQgDVeFGvg2U7bmiwz/yQTz8tmdpvqCsQrIfRLaWf6gDe6tFS+1WvClGhMwsqWuIVlufxj3UVD8lG5Weq86f54vUA2gONZweobWQu+TvDAJyKhERUkq/FABzE9tdRJ9Jm7cbvCdPrUYDjrfYz2DFe8wt9U3ulPVzq/KeCDz/ohbGGiV+pnSvgR3Ph04zyWUvbd5W0rYRQRfekY/lYhgIxpvpornNfz4Eo2Oomyu51hgbuMSuOm3LlJiozdnaZ1cLmRf+I7A==
    - secure: QB1wkQjN8H6TVQL9lOQ3f52+QVm8b55DRsN35yp7VqXznm+DzUyDU8l6pR1LIY1t7oGVA2zIZ8A3afNDpFAvbM1fmIk3Ak9NHmVB8uvjG+JtN3A/1+KJ+Ceek9HYzscmgg9/ngrwoVRaQPQnlLbtNq3Q+Ej7VsMhV0VbUznBj4lBVSATaWW2tgtMkfMo2UQq6yAmJuTcPsnoR6A6RuOaqNfuiTQWPOdRfM7yis3Ye8DfIyBy4pJbcPSG8gNvsmp+bIveMAiK+4TPYJWkaSXolAD5nVxprlRRi+adHEEsV0RbkTr6EwBg/i+3iS/gn5vdqwGcBWlcsAO6ZBgujMOUMw==

  matrix:
    - ARCH=armhf ADDON=inadyn
    - ARCH=amd64 ADDON=inadyn
    - ARCH=i386 ADDON=inadyn
    - ARCH=aarch64 ADDON=inadyn

integrations:
  hub:
    - integrationName: docker-hub
      type: docker

build:
  pre_ci:
    - docker build --build-arg BUILD_FROM="homeassistant/amd64-base:latest" -t ${DOCKER_HUB_USER}/${ARCH}-${ADDON}:${VERSION} -t ${DOCKER_HUB_USER}/${ARCH}-${ADDON}:latest ${ADDON}

  ci:
    - mkdir /tmp/hassio-data
    - touch /tmp/hassio-data/options.json
    - echo ${TEST_OPTIONS} > /tmp/hassio-data/options.json
    - docker run --rm -e HOME=/root -v /tmp/hassio-data:/data ${DOCKER_HUB_USER}/${ARCH}-${ADDON}:${VERSION}

  push:
    - docker push ${DOCKER_HUB_USER}/${ARCH}-${ADDON}:${VERSION}
    - docker push ${DOCKER_HUB_USER}/${ARCH}-${ADDON}:latest
